<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Privy Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #0b0e14;
      color: #e6e9f0;
    }
    .card {
      background: #121826;
      padding: 30px;
      border-radius: 20px;
      text-align: center;
    }
    button {
      padding: 14px 30px;
      background: linear-gradient(135deg, #6cf2c2, #8aa2ff);
      border: none;
      border-radius: 999px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      color: #000;
      margin: 10px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 10px;
      font-size: 0.9rem;
    }
    .success { background: rgba(108, 242, 194, 0.2); color: #6cf2c2; }
    .error { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
    .info { background: rgba(138, 162, 255, 0.2); color: #8aa2ff; }
    pre {
      text-align: left;
      background: #0b0e14;
      padding: 15px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üß™ Privy Login Test</h1>
    <p>Test apakah Privy SDK berfungsi dengan benar</p>
    
    <div id="status" class="status info">‚è≥ Initializing...</div>
    
    <button id="loginBtn" disabled>Login with Email</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
    
    <div id="userInfo" style="display:none; margin-top: 20px;">
      <h3>‚úÖ Logged In</h3>
      <pre id="userData"></pre>
    </div>
    
    <hr style="margin: 30px 0; border-color: #1c2335;">
    
    <h3>üìã Setup Checklist:</h3>
    <div style="text-align: left; font-size: 0.9rem;">
      <p id="check1">‚è≥ Checking Privy SDK...</p>
      <p id="check2">‚è≥ Checking App ID...</p>
      <p id="check3">‚è≥ Checking initialization...</p>
    </div>
    
    <hr style="margin: 30px 0; border-color: #1c2335;">
    
    <div style="font-size: 0.85rem; color: #9aa4bf;">
      <p><strong>How to fix if not working:</strong></p>
      <ol style="text-align: left; line-height: 1.8;">
        <li>Get App ID from <a href="https://dashboard.privy.io" target="_blank" style="color: #6cf2c2;">dashboard.privy.io</a></li>
        <li>Replace "YOUR_PRIVY_APP_ID" in this file (line 95)</li>
        <li>Add your domain to Privy Dashboard ‚Üí Allowed Origins</li>
        <li>Refresh this page</li>
      </ol>
    </div>
  </div>

  <!-- Privy SDK -->
  <script crossorigin src="https://unpkg.com/@privy-io/js-sdk@latest/dist/index.umd.js"></script>
  
  <script>
    const status = document.getElementById('status');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('userInfo');
    const userData = document.getElementById('userData');
    
    let privyClient = null;

    // Update status
    function setStatus(message, type = 'info') {
      status.className = `status ${type}`;
      status.textContent = message;
    }

    // Check 1: SDK loaded
    function checkSDK() {
      if (typeof Privy !== 'undefined') {
        document.getElementById('check1').textContent = '‚úÖ Privy SDK loaded';
        return true;
      } else {
        document.getElementById('check1').textContent = '‚ùå Privy SDK not loaded';
        setStatus('‚ùå Privy SDK failed to load', 'error');
        return false;
      }
    }

    // Wait for SDK
    function waitForSDK() {
      return new Promise((resolve, reject) => {
        let attempts = 0;
        const maxAttempts = 50;
        
        const interval = setInterval(() => {
          attempts++;
          
          if (typeof Privy !== 'undefined') {
            clearInterval(interval);
            resolve();
          } else if (attempts >= maxAttempts) {
            clearInterval(interval);
            reject(new Error('SDK timeout'));
          }
        }, 100);
      });
    }

    // Initialize Privy
    async function initPrivy() {
      try {
        setStatus('‚è≥ Waiting for SDK to load...', 'info');
        
        await waitForSDK();
        
        if (!checkSDK()) return;

        // IMPORTANT: Replace with your actual App ID
        const appId = "YOUR_PRIVY_APP_ID";
        
        // Check 2: App ID
        if (appId === "YOUR_PRIVY_APP_ID") {
          document.getElementById('check2').textContent = '‚ùå App ID not configured';
          setStatus('‚ùå Please replace YOUR_PRIVY_APP_ID with your actual App ID', 'error');
          return;
        } else {
          document.getElementById('check2').textContent = '‚úÖ App ID configured: ' + appId.substring(0, 10) + '...';
        }

        setStatus('‚è≥ Initializing Privy...', 'info');

        // Initialize
        privyClient = new Privy({
          appId: appId,
          config: {
            loginMethods: ['email', 'wallet'],
            appearance: {
              theme: 'dark',
              accentColor: '#6cf2c2'
            }
          }
        });

        document.getElementById('check3').textContent = '‚úÖ Privy initialized successfully';
        setStatus('‚úÖ Ready! Click the button to test login', 'success');
        
        loginBtn.disabled = false;

        // Check existing session
        const authenticated = await privyClient.authenticated();
        if (authenticated) {
          const user = await privyClient.user();
          showUserInfo(user);
        }

      } catch (error) {
        console.error('Init error:', error);
        document.getElementById('check3').textContent = '‚ùå Initialization failed: ' + error.message;
        setStatus('‚ùå Initialization failed: ' + error.message, 'error');
      }
    }

    // Login
    loginBtn.onclick = async () => {
      if (!privyClient) {
        alert('Privy not initialized');
        return;
      }

      try {
        setStatus('‚è≥ Opening login modal...', 'info');
        loginBtn.disabled = true;

        console.log('üöÄ Calling privy.login()...');
        await privyClient.login();
        
        console.log('‚úÖ Login completed');
        const user = await privyClient.user();
        
        showUserInfo(user);
        setStatus('‚úÖ Login successful!', 'success');

      } catch (error) {
        console.error('Login error:', error);
        
        if (error.message && error.message.includes('closed')) {
          setStatus('‚ÑπÔ∏è Login cancelled', 'info');
        } else {
          setStatus('‚ùå Login failed: ' + error.message, 'error');
        }
      } finally {
        loginBtn.disabled = false;
      }
    };

    // Logout
    logoutBtn.onclick = async () => {
      try {
        await privyClient.logout();
        userInfo.style.display = 'none';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        setStatus('‚úÖ Logged out', 'success');
      } catch (error) {
        console.error('Logout error:', error);
      }
    };

    // Show user info
    function showUserInfo(user) {
      userData.textContent = JSON.stringify(user, null, 2);
      userInfo.style.display = 'block';
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
    }

    // Start
    initPrivy();
  </script>
</body>
</html>
